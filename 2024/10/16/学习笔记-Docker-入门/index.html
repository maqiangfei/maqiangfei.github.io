<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>学习笔记 - Docker 入门 | maqiangfei</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="本文简单记录对Docker的学习，包括镜像&#x2F;容器，常见命令，文件挂载，网络及项目部署">
<meta property="og:type" content="article">
<meta property="og:title" content="学习笔记 - Docker 入门">
<meta property="og:url" content="https://maqiangfei.github.io/2024/10/16/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Docker-%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="maqiangfei">
<meta property="og:description" content="本文简单记录对Docker的学习，包括镜像&#x2F;容器，常见命令，文件挂载，网络及项目部署">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/maqiangfei/images/master/2024/10/16-13-42-29-QQ_1729057344402.png">
<meta property="og:image" content="https://raw.githubusercontent.com/maqiangfei/images/master/2024/10/16-15-00-51-QQ_1729062047191.png">
<meta property="og:image" content="https://raw.githubusercontent.com/maqiangfei/images/master/2024/10/16-15-12-30-QQ_1729062746029.png">
<meta property="og:image" content="https://raw.githubusercontent.com/maqiangfei/images/master/2024/10/16-16-49-15-QQ_1729068550470.png">
<meta property="og:image" content="https://raw.githubusercontent.com/maqiangfei/images/master/2024/10/17-09-49-26-QQ_1729129760820.png">
<meta property="og:image" content="https://raw.githubusercontent.com/maqiangfei/images/master/2024/10/17-15-56-19-QQ_1729151776416.png">
<meta property="article:published_time" content="2024-10-16T04:18:39.000Z">
<meta property="article:modified_time" content="2024-10-17T09:45:21.566Z">
<meta property="article:author" content="maqiangfei">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/maqiangfei/images/master/2024/10/16-13-42-29-QQ_1729057344402.png">
  
    <link rel="alternate" href="/" title="maqiangfei" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://maqiangfei.github.io"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">maqiangfei</a>
      </h1>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-学习笔记-Docker-入门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2024/10/16/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Docker-%E5%85%A5%E9%97%A8/" class="article-date">
  <time datetime="2024-10-16T04:18:39.000Z" itemprop="datePublished">2024-10-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      学习笔记 - Docker 入门
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <blockquote>
<p>本文简单记录对Docker的学习，包括镜像&#x2F;容器，常见命令，文件挂载，网络及项目部署</p>
</blockquote>
<span id="more"></span>

<h2 id="镜像和容器"><a href="#镜像和容器" class="headerlink" title="镜像和容器"></a>镜像和容器</h2><p>当我们利用Docker安装应用时，Docker会自动搜索并下载应用镜像。镜像不仅包含应用本身，还包含应用运行所需的环境、配置、系统函数库。Docker会在运行镜像时创建一个隔离环境，称为容器（container）。</p>
<p><img src="https://raw.githubusercontent.com/maqiangfei/images/master/2024/10/16-13-42-29-QQ_1729057344402.png"></p>
<h2 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    --name mysql \</span><br><span class="line">    -p 3307:3306 \</span><br><span class="line">    -e TZ=Asia/Shanghai \</span><br><span class="line">    -e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">    mysql</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>docker run</code>：创建并运行一个容器，参数<code>-d</code>是让容器在后台运行</p>
</li>
<li><p><code>--name mysql</code>：给容器起个名字，必须唯一</p>
</li>
<li><p><code>-e</code>：环境变量</p>
</li>
<li><p><code>-p 3306:3306</code>：设置端口映射，宿主机端口：容器内端口</p>
</li>
<li><p><code>mysql:版本</code>：镜像名称加版本</p>
</li>
</ul>
<img src="https://raw.githubusercontent.com/maqiangfei/images/master/2024/10/16-15-00-51-QQ_1729062047191.png" title="" alt="" width="626">

<h2 id="常见命令"><a href="#常见命令" class="headerlink" title="常见命令"></a>常见命令</h2><p>Docker最常见的命令就是操作镜像、容器的命令，详见官方文档：<a target="_blank" rel="noopener" href="https://docker.com/">https://docker.com</a>.</p>
<p><img src="https://raw.githubusercontent.com/maqiangfei/images/master/2024/10/16-15-12-30-QQ_1729062746029.png"></p>
<div class="overflow">

<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>docker run</code></td>
<td>下载镜像、创建并启动容器</td>
</tr>
<tr>
<td><code>docker stop 容器名</code></td>
<td>停止容器</td>
</tr>
<tr>
<td><code>docker start 容器名</code></td>
<td>启动容器</td>
</tr>
<tr>
<td><code>docker logs -f 容器名</code></td>
<td>-f：持续输出日志</td>
</tr>
<tr>
<td><code>docker exec -it 容器名 bash</code></td>
<td>进入容器内部 -it：终端交互</td>
</tr>
<tr>
<td><code>docker inspect 容器名</code></td>
<td>查看容器详情</td>
</tr>
</tbody></table>
</div>

<h2 id="数据卷挂载"><a href="#数据卷挂载" class="headerlink" title="数据卷挂载"></a>数据卷挂载</h2><p>数据卷（volume）是一个虚拟目录，是容器内目录与宿主机目录之间映射的桥梁</p>
<p><img src="https://raw.githubusercontent.com/maqiangfei/images/master/2024/10/16-16-49-15-QQ_1729068550470.png"></p>
<div class="overflow">

<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>docker volume create</code></td>
<td>创建数据卷</td>
</tr>
<tr>
<td><code>docker volume ls</code></td>
<td>查看所有数据卷</td>
</tr>
<tr>
<td><code>docker volume rm</code></td>
<td>删除指定数据卷</td>
</tr>
<tr>
<td><code>docker volume inspect</code></td>
<td>查看某个数据卷的详情</td>
</tr>
<tr>
<td><code>docker volume prune</code></td>
<td>清除数据卷</td>
</tr>
</tbody></table>
</div>

<p>注意，数据卷的挂载只能在<code>docker run</code>时使用<code>-v 数据卷名:容器内目录</code>进行挂在，当创建容器时，如果挂载的数据卷不存在，会自动创建数据卷</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name nginx -p 80:80 -v html:/usr/share/nginx/html nginx</span><br></pre></td></tr></table></figure>

<h2 id="本地目录挂载"><a href="#本地目录挂载" class="headerlink" title="本地目录挂载"></a>本地目录挂载</h2><p>与数据卷挂载相似，不同的是将数据卷名改为宿主机目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name nginx -p 80:80 -v 本地目录:容器内目录 nginx</span><br></pre></td></tr></table></figure>

<p>注意：本地目录必须以<code>/</code>或<code>./</code>开头，从而区分开数据卷名</p>
<p>下面以mysql为例，宿主机中的文件夹 <code>/root/mysql/conf</code> 中存放mysql的配置文件，<code>/root/mysql/data</code>用于存放数据文件，<code>/root/mysql/init</code>中存放的是sql脚本，在创建容器时，通过<code>-v</code>挂载到容器中的对应文件夹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">--name mysql \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-e TZ=Asia/Shanghai \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">-v /root/mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">-v /root/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /root/mysql/init:/docker-entrypoint-initdb.d \</span><br><span class="line">mysql</span><br></pre></td></tr></table></figure>

<h2 id="自定义镜像"><a href="#自定义镜像" class="headerlink" title="自定义镜像"></a>自定义镜像</h2><p>镜像就是包含了应用程序、程序运行的系统函数库、运行配置等文件的文件包。构建镜像的过程其实就是把上述文件打包的过程。</p>
<p>构建一个Java镜像的步骤：</p>
<ol>
<li>准备一个Linux运行环境</li>
<li>安装JRE并配置环境变量</li>
<li>拷贝Jar包</li>
<li>编写运行脚本</li>
</ol>
<p><strong>层（Layer）</strong></p>
<p>镜像的结构是分层的。添加安装包、依赖、配置等，每次操作都形成新的一层。</p>
<p><strong>基础镜像（BaseImage）</strong></p>
<p>镜像中通用的层，一般是应用依赖的系统函数库、环境、配置、文件等，可以简化镜像的制作</p>
<p><strong>入口（Entrypoint）</strong></p>
<p>镜像运行入口，一般是程序启动的脚本和参数</p>
<p><strong>Dockerfile</strong></p>
<p>Dockerfile是一个文本文件，其中包含一个个的指令，用指令来说明要执行什么操作来构建镜像。将来Docker可以根据Dockerfile帮我们构建镜像。常见指令如下：</p>
<div class="overflow">

<table>
<thead>
<tr>
<th>指令</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>FROM</code></td>
<td>指定基础镜像</td>
<td><code>FROM centos:6</code></td>
</tr>
<tr>
<td><code>ENV</code></td>
<td>设置环境变量，可在后面指令使用</td>
<td><code>ENV</code> key value</td>
</tr>
<tr>
<td><code>COPY</code></td>
<td>拷贝本地文件到镜像的指定目录</td>
<td><code>COPY ./jrell.tar.gz /tmp</code></td>
</tr>
<tr>
<td><code>RUN</code></td>
<td>执行Linux的shell命令，一般是安装过程的命令</td>
<td><code>RUN tar -zxvf /tmp/jrell.tar.gz </code><br/><code>&amp;&amp; EXPORTS path=/tmp/jrell:$path</code></td>
</tr>
<tr>
<td><code>EXPOSE</code></td>
<td>指定容器运行时监听的端口，是给镜像使用者看的</td>
<td><code>EXPOSE 8080</code></td>
</tr>
<tr>
<td><code>ENTRYPOINT</code></td>
<td>镜像中应用的启动命令，容器运行时调用</td>
<td><code>ENTRYPOINT java -jar xx.jar</code></td>
</tr>
</tbody></table>
</div>

<p>下面是基于Ubuntu基础镜像，利用Dockerfile描述镜像结构的案例</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">16.04</span></span><br><span class="line"><span class="comment"># 配置环境变量，JDK的安装目录、容器内时区</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_DIR=/usr/local</span><br><span class="line"><span class="comment"># 拷贝jdk和java项目的包</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./jdk8.tar.gz <span class="variable">$JAVA_DIR</span>/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./docker-demo.jar /tmp/app.jar</span></span><br><span class="line"><span class="comment"># 安装JDK</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">cd</span> <span class="variable">$JAVA_DIR</span> \ &amp;&amp; tar -xf ./jdk8.tar.gz \</span></span><br><span class="line"><span class="language-bash">&amp;&amp; <span class="built_in">mv</span> ./jdk1.8.0_144 ./java8</span></span><br><span class="line"><span class="comment"># 配置环境变量</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME=$JAVA_DIR/java8</span><br><span class="line"><span class="keyword">ENV</span> PATH=$JAVA_HOME/bin</span><br><span class="line"><span class="comment"># 入口，java项目的启动命令</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>也可以直接基于JDK为基础镜像，省略前面的步骤：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">11.0</span>-jre-buster</span><br><span class="line"><span class="comment"># 拷贝jar包</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> docker-demo.jar /app.jar</span></span><br><span class="line"><span class="comment"># 入口</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>当编写好了Dockerfile，可以利用下面命令来构建镜像，注意，上述的 DockerFile 中的<code>docker-demo.jar</code>需要和 DockerFile 在同级目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t docker-demo dockerfile所在目录</span><br></pre></td></tr></table></figure>

<p>构建后对象后，可以使用 <code>docker run</code>创建容器运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name docker-demo -p 8080:8080 docker-demo</span><br></pre></td></tr></table></figure>

<p>查看日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f docker-demo</span><br></pre></td></tr></table></figure>

<h2 id="容器网络互联"><a href="#容器网络互联" class="headerlink" title="容器网络互联"></a>容器网络互联</h2><p>默认情况下，所有容器都是以bridge方式连接到Docker的一个虚拟网桥上</p>
<p><img src="https://raw.githubusercontent.com/maqiangfei/images/master/2024/10/17-09-49-26-QQ_1729129760820.png"></p>
<p><strong>常用命令</strong></p>
<div class="overflow">

<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>docker network create 网络名</code></td>
<td>创建一个网络</td>
</tr>
<tr>
<td><code>docker network ls</code></td>
<td>查看所有网络</td>
</tr>
<tr>
<td><code>docker network rm 网络名</code></td>
<td>删除指定网络</td>
</tr>
<tr>
<td><code>docker network prune</code></td>
<td>清除未使用的网络</td>
</tr>
<tr>
<td><code>docker network connect 网络名 容器名</code></td>
<td>使指定容器连接加入某网络</td>
</tr>
<tr>
<td><code>docker network disconnect</code></td>
<td>使指定容器连接离开某网络</td>
</tr>
<tr>
<td><code>docker network inspect</code></td>
<td>查看网络详细信息</td>
</tr>
</tbody></table>
</div>

<p>可以在创建并运行容器的时候就指定网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker network create mqf</span><br><span class="line">docker run -d --name docker-demo -p 8080:8080 --network mqf docker-demo </span><br></pre></td></tr></table></figure>

<p>当两个容器加入同一个自定义网络后，它们可以通过容器名进行访问</p>
<h2 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h2><h3 id="Java应用"><a href="#Java应用" class="headerlink" title="Java应用"></a>Java应用</h3><ol>
<li><p>创建自定义网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create mqf</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建mysql容器，指定自定义的网络，并对文件进行挂载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    --name mysql \</span><br><span class="line">    -p 3306:3306 \</span><br><span class="line">    -e TZ=Asia/Shanghai \</span><br><span class="line">    -e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">    -v /root/mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">    -v /root/mysql/data:/var/lib/mysql \</span><br><span class="line">    -v /root/mysql/init:/docker-entrypoint-initdb.d \</span><br><span class="line">    --network mqf \</span><br><span class="line">    mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>将项目jar包拷贝到服务器</p>
</li>
<li><p>创建DockerFile文件，放在jar包同级目录下</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">11.0</span>-jre-buster</span><br><span class="line"><span class="comment"># 设定时区</span></span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">ln</span> -snf /usr/share/zoneinfo/<span class="variable">$TZ</span> /etc/localtime &amp;&amp; <span class="built_in">echo</span> <span class="variable">$TZ</span> &gt; /etc/timezone</span></span><br><span class="line"><span class="comment"># 拷贝jar包</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> hm-service.jar /app.jar</span></span><br><span class="line"><span class="comment"># 入口</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>制作镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t demo .</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建容器，并指定自定义的网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name demo -p 8080:8080 --network mqf demo</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看运行日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f demo</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="前端部署"><a href="#前端部署" class="headerlink" title="前端部署"></a>前端部署</h3><ol>
<li><p>编写要挂载的nginx配置文件，下面是一个案例。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/json;</span><br><span class="line"></span><br><span class="line">    sendfile        <span class="keyword">on</span>;</span><br><span class="line"></span><br><span class="line">    keepalive_timeout  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       <span class="number">18080</span>;</span><br><span class="line">        # 指定前端项目所在的位置</span><br><span class="line">        location / &#123;</span><br><span class="line">            root /usr/share/nginx/html/hmall-portal;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /<span class="number">50</span><span class="keyword">x</span>.html;</span><br><span class="line">        location = /<span class="number">50</span><span class="keyword">x</span>.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">        location /api &#123;</span><br><span class="line">            rewrite /api/(.*)  /$<span class="number">1</span> <span class="keyword">break</span>;</span><br><span class="line">            proxy_pass http://hmal<span class="variable">l:8080</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       <span class="number">18081</span>;</span><br><span class="line">        # 指定前端项目所在的位置</span><br><span class="line">        location / &#123;</span><br><span class="line">            root /usr/share/nginx/html/hmall-admin;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /<span class="number">50</span><span class="keyword">x</span>.html;</span><br><span class="line">        location = /<span class="number">50</span><span class="keyword">x</span>.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">        location /api &#123;</span><br><span class="line">            rewrite /api/(.*)  /$<span class="number">1</span> <span class="keyword">break</span>;</span><br><span class="line">            proxy_pass http://hmal<span class="variable">l:8080</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该nginx要部署在容器中，所以监听的是容器的18080端口，如果转发的容器和nginx容器在同一个网络中，则转发的地址可以使用容器名替代。</p>
</li>
<li><p>创建nginx容器，并挂载配置文件和html目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    --name nginx \</span><br><span class="line">    -p 18080:18080 \</span><br><span class="line">    -p 18081:18081 \</span><br><span class="line">    -v /root/nginx/html:/usr/share/nginx/html \</span><br><span class="line">    -v /root/nginx/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">    --network mqf \</span><br><span class="line">    nginx</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="DockerCompose"><a href="#DockerCompose" class="headerlink" title="DockerCompose"></a>DockerCompose</h3><p>Docker Compose 通过一个单独的 docker-compose.yml 模板文件（YAML格式）来定义一组相关联的应用容器，帮助我们实现多个相互关联的Docker容器的快速部署。</p>
<p><img src="https://raw.githubusercontent.com/maqiangfei/images/master/2024/10/17-15-56-19-QQ_1729151776416.png"></p>
<p>下面是一个案例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./mysql/conf:/etc/mysql/conf.d&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./mysql/data:/var/lib/mysql&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./mysql/init:/docker-entrypoint-initdb.d&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hm-net</span></span><br><span class="line">  <span class="attr">hmall:</span></span><br><span class="line">    <span class="attr">build:</span> </span><br><span class="line">      <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hmall</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hm-net</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;18080:18080&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;18081:18081&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./nginx/nginx.conf:/etc/nginx/nginx.conf&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./nginx/html:/usr/share/nginx/html&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hmall</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hm-net</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">hm-net:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">hmall</span></span><br></pre></td></tr></table></figure>

<p>部署命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose [OPTIONS] [COMMAND]</span><br></pre></td></tr></table></figure>

<div class="overflow">

<table>
<thead>
<tr>
<th>类型</th>
<th>参数&#x2F;指令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Options</td>
<td><code>-f</code></td>
<td>指定compose文件的路径和名称</td>
</tr>
<tr>
<td></td>
<td><code>-p</code></td>
<td>指定project名称，默认<code>root</code></td>
</tr>
<tr>
<td>Commands</td>
<td><code>up</code></td>
<td>创建并启动所有service容器</td>
</tr>
<tr>
<td></td>
<td><code>down</code></td>
<td>停止并移除所有容器、网络</td>
</tr>
<tr>
<td></td>
<td><code>ps</code></td>
<td>列出所有启动的容器</td>
</tr>
<tr>
<td></td>
<td><code>logs</code></td>
<td>查看指定容器的日志</td>
</tr>
<tr>
<td></td>
<td><code>stop</code></td>
<td>停止容器</td>
</tr>
<tr>
<td></td>
<td><code>start</code></td>
<td>启动容器</td>
</tr>
<tr>
<td></td>
<td><code>restart</code></td>
<td>重启容器</td>
</tr>
<tr>
<td></td>
<td><code>top</code></td>
<td>查看运行的进程</td>
</tr>
<tr>
<td></td>
<td><code>exec</code></td>
<td>在指定的运行容器中执行命令</td>
</tr>
</tbody></table>
</div>

<p>例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署 -- 注意：当前目录下有docker-compose.yml文件</span></span><br><span class="line">docker compose -p hmall up -d</span><br><span class="line"><span class="comment"># 清除部署</span></span><br><span class="line">docker compose down</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://maqiangfei.github.io/2024/10/16/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Docker-%E5%85%A5%E9%97%A8/" data-id="cm2bva5lq0007azfyc7uqd5oy" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li></ul>

    </footer>
  </div>
  
    
 
<script src="/jquery/jquery.min.js"></script>

  <div id="random_posts">
    <h2>推荐文章</h2>
    <div class="random_posts_ul">
      <script>
          var random_count =4
          var site = {BASE_URI:'/'};
          function load_random_posts(obj) {
              var arr=site.posts;
              if (!obj) return;
              // var count = $(obj).attr('data-count') || 6;
              for (var i, tmp, n = arr.length; n; i = Math.floor(Math.random() * n), tmp = arr[--n], arr[n] = arr[i], arr[i] = tmp);
              arr = arr.slice(0, random_count);
              var html = '<ul>';
            
              for(var j=0;j<arr.length;j++){
                var item=arr[j];
                html += '<li><strong>' + 
                item.date + ':&nbsp;&nbsp;<a href="' + (site.BASE_URI+item.uri) + '">' + 
                (item.title || item.uri) + '</a></strong>';
                if(item.excerpt){
                  html +='<div class="post-excerpt">'+item.excerpt+'</div>';
                }
                html +='</li>';
                
              }
              $(obj).html(html + '</ul>');
          }
          $('.random_posts_ul').each(function () {
              var c = this;
              if (!site.posts || !site.posts.length){
                  $.getJSON(site.BASE_URI + 'js/posts.js',function(json){site.posts = json;load_random_posts(c)});
              } 
               else{
                load_random_posts(c);
              }
          });
      </script>
    </div>
  </div>

    
<nav id="article-nav">
  
    <a href="/2024/10/16/Linux-%E5%AE%89%E8%A3%85-Docker/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          Linux 安装 Docker
        
      </div>
    </a>
  
  
    <a href="/2024/10/13/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%88%9D%E8%AF%86JVM/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">学习笔记 - 初识JVM</div>
    </a>
  
</nav>

  
</article>
 
     
  <div class="comments" id="comments">
    
     
       
      <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    
       
      
      
  </div>
 
  </section>
           
    <aside id="sidebar">
  
    

  
    
  
    
    <div class="widget-wrap">
    
      <div class="widget" id="toc-widget-fixed">
      
        <strong class="toc-title">文章目录</strong>
        <div class="toc-widget-list">
              <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%92%8C%E5%AE%B9%E5%99%A8"><span class="toc-number">1.</span> <span class="toc-text">镜像和容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85MySQL"><span class="toc-number">2.</span> <span class="toc-text">安装MySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4"><span class="toc-number">3.</span> <span class="toc-text">常见命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E6%8C%82%E8%BD%BD"><span class="toc-number">4.</span> <span class="toc-text">数据卷挂载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E7%9B%AE%E5%BD%95%E6%8C%82%E8%BD%BD"><span class="toc-number">5.</span> <span class="toc-text">本地目录挂载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8F"><span class="toc-number">6.</span> <span class="toc-text">自定义镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%BA%92%E8%81%94"><span class="toc-number">7.</span> <span class="toc-text">容器网络互联</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2"><span class="toc-number">8.</span> <span class="toc-text">项目部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java%E5%BA%94%E7%94%A8"><span class="toc-number">8.1.</span> <span class="toc-text">Java应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2"><span class="toc-number">8.2.</span> <span class="toc-text">前端部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DockerCompose"><span class="toc-number">8.3.</span> <span class="toc-text">DockerCompose</span></a></li></ol></li></ol>
          </div>
      </div>
    </div>

  
    

  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2024 maqiangfei&nbsp;|&nbsp;
      主题 <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;qiangfei.ma@qq.com
    </div>
  </div>
</footer>
 
<script src="/jquery/jquery.min.js"></script>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
      

  
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "e2fb4051c49842688ce669e634bc983f",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
    

  







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

<!-- author:forvoid end -->

<!-- author:forvoid end -->


  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      })
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      })
    </script>
    <script type="text/javascript" src="https://cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


 
<script src="/js/is.js"></script>



  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


<script src="/js/elevator.js"></script>

  </div>
</body>
</html>